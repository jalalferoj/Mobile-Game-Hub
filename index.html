<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>20 Player Games Hub</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0d1117;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 1rem;
        }
        .container-shadow {
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }
        .game-card {
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
            min-height: 120px;
        }
        .game-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(245, 158, 11, 0.3);
        }
        /* Shared Game UI Styling */
        .dice-display, .game-button-lg, .cell {
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 12px;
            font-weight: 700;
        }
        .dice-display {
            font-size: 3rem;
            width: 90px;
            height: 90px;
            background-color: white;
            color: #111827;
        }
        .current-player-card {
            border: 3px solid transparent;
            animation: pulse-border 1.5s infinite;
        }
        @keyframes pulse-border {
            0% { border-color: transparent; }
            50% { border-color: #f59e0b; }
            100% { border-color: transparent; }
        }
        /* Tic-Tac-Toe / Grid Games */
        .tictactoe-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(3, 1fr);
            width: 90vw;
            max-width: 300px;
            aspect-ratio: 1 / 1;
            margin: 1rem auto;
            border: 4px solid #f59e0b;
        }
        .ttt-cell {
            border: 1px solid #4b5563;
            font-size: 3rem;
            cursor: pointer;
            transition: background-color 0.1s;
        }
        .ttt-cell:hover:not(:empty) {
            background-color: transparent;
        }
        .ttt-cell:hover:empty {
            background-color: #374151;
        }
    </style>
</head>
<body class="text-white">

    <div id="app-container" class="w-full max-w-4xl mx-auto bg-gray-800 p-6 rounded-xl container-shadow mb-4">
        <h1 class="text-4xl font-black text-center text-yellow-400 mb-6">Mobile Game Hub</h1>

        <!-- Main Menu Screen -->
        <div id="main-menu" class="hidden">
            <h2 class="text-2xl font-bold mb-4 text-gray-300 text-center">Select a Mini-Game (1-4 Players)</h2>
            <div id="game-list" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4">
                <!-- Game cards will be rendered here -->
            </div>
        </div>

        <!-- Dynamic Game Container -->
        <div id="game-wrapper" class="hidden">
            <button id="back-to-menu-btn" class="mb-4 py-2 px-4 bg-gray-700 hover:bg-gray-600 rounded-lg text-sm transition duration-150 shadow-md">
                ‚Üê Back to Menu
            </button>
            <h2 id="current-game-title" class="text-3xl font-bold text-center text-yellow-400 mb-6"></h2>
            <div id="game-content">
                <!-- Game UI and logic will be injected here -->
            </div>
        </div>
    </div>

    <!-- Modal for Winner Message & Information -->
    <div id="info-modal" class="fixed inset-0 bg-black bg-opacity-80 hidden z-50 flex items-center justify-center p-4">
        <div class="bg-gray-700 p-6 sm:p-8 rounded-xl shadow-2xl w-full max-w-md">
            <h3 id="modal-title" class="text-2xl font-bold mb-4 text-yellow-400 text-center"></h3>
            <p id="modal-body" class="text-gray-300 mb-6 leading-relaxed"></p>
            <button id="close-modal-btn" class="w-full py-3 bg-red-600 hover:bg-red-700 text-white font-bold rounded-xl transition duration-150">
                Close
            </button>
        </div>
    </div>

    <script>
        // Set up the Firebase globals (required for the platform, even if not used in this iteration)
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};

        // --- GLOBAL STATE & CONSTANTS ---
        let currentGameId = 'menu';
        const TARGET_SCORE = 50;
        let players = [];
        let currentPlayerIndex = 0;
        let isGameActive = false;
        const PLAYER_COLORS = ['yellow-400', 'cyan-400', 'pink-400', 'lime-400'];

        // Game-specific states (to be reset/initialized by each game's render function)
        let gameSpecificState = {};

        const MINI_GAMES = [
            { id: 'dice-duel', name: 'Dice Duel', icon: 'üé≤', players: '2-4', implemented: true, description: 'Classic Pig Dice: Race to 50, but lose turn points if you roll a 1.' },
            { id: 'rps', name: 'Rock Paper Scissors', icon: '‚úä‚úã‚úåÔ∏è', players: '2', implemented: true, description: 'Best-of-5 competition.' },
            { id: 'coin-race', name: 'Coin Flip Race', icon: 'ü™ô', players: '2-4', implemented: true, description: 'Players choose H/T and race to 10 correct calls.' },
            { id: 'quick-draw', name: 'Quick Draw', icon: '‚ö°', players: '2', implemented: true, description: 'Reaction speed test. Tap on "DRAW!".' },
            { id: 'last-man-standing', name: 'Last Man Standing', icon: 'üõë', players: '2-4', implemented: true, description: 'Hold your button. The first to release is out.' },
            { id: 'tile-match', name: 'Tile Match Battle', icon: 'üß©', players: '2', implemented: true, description: 'Match pairs to score points (4x4 grid).' },
            { id: 'high-card', name: 'High Card Draw', icon: 'üÉè', players: '2-4', implemented: true, description: 'Highest card drawn wins the round.' },
            { id: 'num-guess', name: 'Number Guess Duel', icon: 'üî¢', players: '2', implemented: true, description: 'Guess a number (1-100) with "Higher/Lower" clues.' },
            { id: 'odd-even', name: 'Odd or Even Challenge', icon: '‚ûï', players: '2-4', implemented: true, description: 'Score points by correctly guessing if the sum of secret numbers is Odd or Even.' },
            { id: 'memory-grid', name: 'Memory Grid', icon: 'üß†', players: '1', implemented: true, description: 'Repeat the sequence of glowing squares.' },
            { id: 'color-test', name: 'Color Blind Test', icon: 'üëÅÔ∏è', players: '1-4', implemented: true, description: 'Identify the number hidden in the colored dots.' },
            { id: 'fast-math', name: 'Fast Math Challenge', icon: '‚ûó', players: '1-4', implemented: true, description: 'Race to solve simple addition problems.' },
            { id: 'hanoi', name: 'Tower of Hanoi', icon: 'üóº', players: '1', implemented: true, description: 'Move 3 discs to another peg in the fewest moves.' },
            { id: 'simon-says', name: 'Simon Says Lite', icon: 'üëÇ', players: '1', implemented: true, description: 'Follow the increasing sequence of colors.' },
            { id: 'codebreaker', name: 'Codebreaker', icon: 'üîê', players: '2', implemented: true, description: 'Guess the secret 4-color code.' },
            { id: 'hangman', name: 'Hangman Duel', icon: '‚úçÔ∏è', players: '2', implemented: true, description: 'One player sets word, the other guesses letters.' },
            { id: 'ttt', name: 'Tic-Tac-Toe', icon: '‚ùå‚≠ï', players: '2', implemented: true, description: 'Classic 3x3 grid game.' },
            { id: 'four-row', name: 'Four in a Row', icon: 'üîµüî¥', players: '2', implemented: true, description: 'Simple 4-in-a-row on a 4x4 grid.' },
            { id: 'dot-connect', name: 'Dot Connect Race', icon: '‚ö´', players: '2', implemented: true, description: 'Draw lines to claim boxes on a 3x3 grid.' },
            { id: 'maze-runner', name: 'Maze Runner', icon: 'üó∫Ô∏è', players: '1', implemented: true, description: 'Navigate a simple 5x5 maze using movement buttons.' },
        ];


        // --- DOM Elements ---
        const mainMenu = document.getElementById('main-menu');
        const gameWrapper = document.getElementById('game-wrapper');
        const gameListContainer = document.getElementById('game-list');
        const currentGameTitle = document.getElementById('current-game-title');
        const gameContent = document.getElementById('game-content');
        const backToMenuBtn = document.getElementById('back-to-menu-btn');
        const infoModal = document.getElementById('info-modal');
        const modalTitle = document.getElementById('modal-title');
        const modalBody = document.getElementById('modal-body');
        const closeModalBtn = document.getElementById('close-modal-btn');


        // --- UTILITY FUNCTIONS ---

        /** Shows a custom modal with a title and message. */
        function showModal(title, body, isWinner = false) {
            modalTitle.textContent = title;
            modalBody.innerHTML = body;
            modalTitle.classList.toggle('text-green-400', isWinner);
            modalTitle.classList.toggle('text-yellow-400', !isWinner);
            infoModal.classList.remove('hidden');
        }

        /** Creates the standard player setup form UI. */
        function renderSetupUI(maxPlayers) {
            const numPlayers = Math.min(Math.max(2, maxPlayers), 4);
            const playerOptions = Array.from({ length: numPlayers - 1 }, (_, i) => `<option value="${i + 2}" ${i + 2 === 2 ? 'selected' : ''}>${i + 2} Players</option>`).join('');

            return `
                <div id="setup-screen" class="max-w-md mx-auto p-4 bg-gray-700 rounded-xl shadow-inner">
                    <h3 class="text-xl font-semibold mb-4 text-center">Setup (Max ${numPlayers} Players)</h3>

                    <label for="player-count-${currentGameId}" class="block mb-2 text-sm font-medium">Select Player Count:</label>
                    <select id="player-count-${currentGameId}" class="w-full p-3 mb-4 rounded-lg bg-gray-900 border border-gray-700 text-lg">
                        ${playerOptions}
                    </select>

                    <div id="player-name-inputs-${currentGameId}" class="space-y-3"></div>

                    <button id="start-game-btn-${currentGameId}" class="w-full mt-6 py-4 bg-green-600 hover:bg-green-700 text-white font-bold rounded-xl transition duration-150 shadow-lg text-xl">
                        Start Game
                    </button>
                </div>
            `;
        }

        /** Creates the initial players array from the setup form. */
        function initializePlayers(minPlayers, maxPlayers, playerCountId, nameInputsId) {
            const count = parseInt(document.getElementById(playerCountId).value);
            players = [];
            for (let i = 1; i <= count; i++) {
                const nameInput = document.getElementById(`${nameInputsId}-${i}`);
                players.push({
                    name: nameInput.value.trim() || `Player ${i}`,
                    score: 0,
                    color: PLAYER_COLORS[i % 4],
                    id: i,
                    active: true // For elimination games
                });
            }
            currentPlayerIndex = 0;
            isGameActive = true;
        }

        /** Renders dynamic player name inputs based on count. */
        function updatePlayerNameInputs(playerCountId, nameInputsId) {
            const count = parseInt(document.getElementById(playerCountId).value);
            const container = document.getElementById(nameInputsId);
            container.innerHTML = '';
            for (let i = 1; i <= count; i++) {
                const input = document.createElement('input');
                input.type = 'text';
                input.id = `${nameInputsId}-${i}`;
                input.placeholder = `Player ${i} Name`;
                input.value = `Player ${i}`;
                input.className = 'w-full p-3 rounded-lg bg-gray-900 border border-gray-700 text-white placeholder-gray-400 focus:ring-yellow-500 focus:border-yellow-500';
                container.appendChild(input);
            }
        }

        /** Renders the responsive player score cards. */
        function renderScoreCards(containerId) {
            const container = document.getElementById(containerId);
            const activePlayers = players.filter(p => p.active);
            const totalPlayers = activePlayers.length;

            let gridColsClass;
            if (totalPlayers === 1) gridColsClass = 'grid-cols-1';
            else if (totalPlayers === 2) gridColsClass = 'grid-cols-2';
            else if (totalPlayers === 3 || totalPlayers === 4) gridColsClass = 'grid-cols-2 sm:grid-cols-4';

            container.className = `grid gap-4 mb-6 ${gridColsClass}`;
            container.innerHTML = activePlayers.map((player, index) => {
                const isCurrent = player.id - 1 === currentPlayerIndex;
                const activeClass = isCurrent ? `current-player-card ring-4 ring-${player.color}` : 'border-gray-700';
                const textColorClass = `text-${player.color}`;

                return `
                    <div class="p-3 rounded-xl border-2 transition-all duration-300 bg-gray-700 shadow-md ${activeClass}">
                        <h3 class="text-lg font-bold mb-1 ${textColorClass}">${player.name}</h3>
                        <p class="text-sm text-gray-400">Score:</p>
                        <p id="player-score-${player.id}" class="text-3xl font-extrabold">${player.score}</p>
                    </div>
                `;
            }).join('');
        }


        // --- GAME IMPLEMENTATIONS (1-20) ---

        const gamesLogic = {
            'dice-duel': {
                state: { currentTurnScore: 0, target: 50 },
                init: function() {
                    const gameId = 'dice-duel';
                    gameContent.innerHTML = renderSetupUI(4) + `
                        <div id="dice-game-screen" class="hidden max-w-md mx-auto text-center">
                            <p id="message-box" class="text-lg font-bold mb-4 h-6 text-yellow-400"></p>
                            <div id="score-cards-${gameId}" class="grid gap-4 mb-6"></div>
                            <div class="flex flex-col items-center justify-center mb-6">
                                <div id="dice-${gameId}" class="dice-display">?</div>
                                <div class="text-center mt-2">
                                    <p class="text-sm text-gray-400">Current Roll Points:</p>
                                    <p id="current-score-${gameId}" class="text-4xl font-extrabold text-yellow-400">0</p>
                                </div>
                            </div>
                            <div class="flex space-x-4">
                                <button id="roll-btn-${gameId}" class="flex-1 py-4 bg-indigo-600 hover:bg-indigo-700 text-white font-bold rounded-xl transition duration-150 shadow-lg text-xl">üé≤ Roll</button>
                                <button id="hold-btn-${gameId}" class="flex-1 py-4 bg-red-600 hover:bg-red-700 text-white font-bold rounded-xl transition duration-150 shadow-lg text-xl">üõë Hold</button>
                            </div>
                            <button id="reset-btn-${gameId}" class="w-full mt-4 py-3 bg-gray-600 hover:bg-gray-700 text-white font-bold rounded-xl transition duration-150 text-base">Reset/New Duel</button>
                        </div>
                    `;

                    // Setup Logic
                    document.getElementById(`player-count-${gameId}`).addEventListener('change', () => updatePlayerNameInputs(`player-count-${gameId}`, `player-name-inputs-${gameId}`));
                    updatePlayerNameInputs(`player-count-${gameId}`, `player-name-inputs-${gameId}`);

                    document.getElementById(`start-game-btn-${gameId}`).addEventListener('click', () => {
                        initializePlayers(2, 4, `player-count-${gameId}`, `player-name-inputs-${gameId}`);
                        gamesLogic[gameId].state.currentTurnScore = 0;
                        document.getElementById('setup-screen').classList.add('hidden');
                        document.getElementById('dice-game-screen').classList.remove('hidden');
                        gamesLogic[gameId].updateUI();
                    });

                    // Game Logic
                    document.getElementById(`roll-btn-${gameId}`).addEventListener('click', gamesLogic[gameId].roll);
                    document.getElementById(`hold-btn-${gameId}`).addEventListener('click', gamesLogic[gameId].hold);
                    document.getElementById(`reset-btn-${gameId}`).addEventListener('click', () => {
                         document.getElementById('setup-screen').classList.remove('hidden');
                         document.getElementById('dice-game-screen').classList.add('hidden');
                    });
                },
                updateUI: function() {
                    if (!isGameActive) return;
                    const gameId = 'dice-duel';
                    renderScoreCards(`score-cards-${gameId}`);
                    document.getElementById(`current-score-${gameId}`).textContent = gamesLogic[gameId].state.currentTurnScore;

                    const currentPlayer = players[currentPlayerIndex];
                    document.getElementById('message-box').textContent = `${currentPlayer.name}'s Turn! (Roll or Hold)`;
                    document.getElementById('message-box').className = `text-center text-lg font-bold mb-4 text-${currentPlayer.color}`;
                },
                roll: function() {
                    const gameId = 'dice-duel';
                    if (!isGameActive) return;

                    const roll = Math.floor(Math.random() * 6) + 1;
                    const diceDisplay = document.getElementById(`dice-${gameId}`);
                    diceDisplay.classList.add('animate-spin');
                    diceDisplay.textContent = '...';

                    setTimeout(() => {
                        diceDisplay.classList.remove('animate-spin');
                        diceDisplay.textContent = roll;

                        if (roll === 1) {
                            gamesLogic[gameId].state.currentTurnScore = 0;
                            showModal('Bummer!', `${players[currentPlayerIndex].name} rolled a **1** and lost the turn points!`, false);
                            gamesLogic[gameId].updateUI();
                            setTimeout(gamesLogic[gameId].nextTurn, 1000);
                        } else {
                            gamesLogic[gameId].state.currentTurnScore += roll;
                            gamesLogic[gameId].updateUI();
                        }
                    }, 500);
                },
                hold: function() {
                    const gameId = 'dice-duel';
                    if (!isGameActive || gamesLogic[gameId].state.currentTurnScore === 0) return;

                    const currentPlayer = players[currentPlayerIndex];
                    currentPlayer.score += gamesLogic[gameId].state.currentTurnScore;
                    gamesLogic[gameId].state.currentTurnScore = 0;

                    if (currentPlayer.score >= gamesLogic[gameId].state.target) {
                        isGameActive = false;
                        showModal('üèÜ WINNER!', `<p class="text-3xl font-semibold text-center text-${currentPlayer.color}">${currentPlayer.name} wins the Duel!</p>`, true);
                    } else {
                        gamesLogic[gameId].updateUI();
                        gamesLogic[gameId].nextTurn();
                    }
                },
                nextTurn: function() {
                    currentPlayerIndex = (currentPlayerIndex + 1) % players.length;
                    gamesLogic['dice-duel'].updateUI();
                }
            },

            'rps': {
                state: { round: 0, player1Score: 0, player2Score: 0, choices: ['Rock', 'Paper', 'Scissors'] },
                init: function() {
                    const gameId = 'rps';
                    gameContent.innerHTML = `
                        <div id="rps-setup" class="max-w-md mx-auto">${renderSetupUI(2)}</div>
                        <div id="rps-game-screen" class="hidden max-w-md mx-auto text-center">
                            <div id="score-cards-${gameId}" class="grid grid-cols-2 gap-4 mb-6"></div>
                            <p id="rps-message" class="text-lg font-bold mb-6 text-yellow-400">Choose your weapon!</p>

                            <div class="flex justify-around space-x-4 mb-8">
                                <button id="rps-btn-rock" class="text-5xl p-4 bg-gray-700 hover:bg-gray-600 rounded-xl transition duration-150 shadow-lg">‚úä</button>
                                <button id="rps-btn-paper" class="text-5xl p-4 bg-gray-700 hover:bg-gray-600 rounded-xl transition duration-150 shadow-lg">‚úã</button>
                                <button id="rps-btn-scissors" class="text-5xl p-4 bg-gray-700 hover:bg-gray-600 rounded-xl transition duration-150 shadow-lg">‚úåÔ∏è</button>
                            </div>
                            <p id="rps-round" class="text-xl font-bold">Round 1 of 5</p>
                        </div>
                    `;
                    document.getElementById(`player-count-${gameId}`).value = 2; // Fixed to 2 players
                    document.getElementById(`player-count-${gameId}`).disabled = true;

                    updatePlayerNameInputs(`player-count-${gameId}`, `player-name-inputs-${gameId}`);
                    document.getElementById(`player-count-${gameId}`).addEventListener('change', () => updatePlayerNameInputs(`player-count-${gameId}`, `player-name-inputs-${gameId}`));

                    document.getElementById(`start-game-btn-${gameId}`).addEventListener('click', () => {
                        initializePlayers(2, 2, `player-count-${gameId}`, `player-name-inputs-${gameId}`);
                        gamesLogic[gameId].state.round = 1;
                        gamesLogic[gameId].state.player1Score = 0;
                        gamesLogic[gameId].state.player2Score = 0;
                        document.getElementById('rps-setup').classList.add('hidden');
                        document.getElementById('rps-game-screen').classList.remove('hidden');
                        gamesLogic[gameId].updateUI();
                    });

                    // Game Logic
                    document.getElementById('rps-btn-rock').addEventListener('click', () => gamesLogic[gameId].play(0));
                    document.getElementById('rps-btn-paper').addEventListener('click', () => gamesLogic[gameId].play(1));
                    document.getElementById('rps-btn-scissors').addEventListener('click', () => gamesLogic[gameId].play(2));
                },
                updateUI: function() {
                    const gameId = 'rps';
                    players[0].score = gamesLogic[gameId].state.player1Score;
                    players[1].score = gamesLogic[gameId].state.player2Score;
                    renderScoreCards(`score-cards-${gameId}`);
                    document.getElementById('rps-round').textContent = `Round ${gamesLogic[gameId].state.round} of 5`;
                    document.getElementById('rps-message').textContent = 'Make your move!';
                },
                play: function(playerChoiceIndex) {
                    const gameId = 'rps';
                    if (!isGameActive) return;

                    const opponentChoiceIndex = Math.floor(Math.random() * 3);
                    const result = (playerChoiceIndex - opponentChoiceIndex + 3) % 3; // 0=Tie, 1=Win, 2=Loss

                    let message;
                    let winner = null;

                    if (result === 0) {
                        message = `Tie! Both chose **${gamesLogic[gameId].state.choices[playerChoiceIndex]}**`;
                    } else if (result === 1) {
                        gamesLogic[gameId].state.player1Score++;
                        message = `**${players[0].name} Wins!** (${gamesLogic[gameId].state.choices[playerChoiceIndex]} beats ${gamesLogic[gameId].state.choices[opponentChoiceIndex]})`;
                    } else {
                        gamesLogic[gameId].state.player2Score++;
                        message = `**${players[1].name} Wins!** (${gamesLogic[gameId].state.choices[opponentChoiceIndex]} beats ${gamesLogic[gameId].state.choices[playerChoiceIndex]})`;
                    }

                    showModal(`Round ${gamesLogic[gameId].state.round} Result`, message);
                    gamesLogic[gameId].state.round++;

                    if (gamesLogic[gameId].state.round > 5) {
                        isGameActive = false;
                        const p1s = gamesLogic[gameId].state.player1Score;
                        const p2s = gamesLogic[gameId].state.player2Score;
                        if (p1s > p2s) winner = players[0].name;
                        else if (p2s > p1s) winner = players[1].name;
                        else winner = 'Nobody! It\'s a Tie!';

                        showModal('GAME OVER!', `Final Score: ${p1s} - ${p2s}. <p class="mt-4 text-3xl font-extrabold text-green-400">${winner}</p>`, p1s !== p2s);
                    }
                    gamesLogic[gameId].updateUI();
                }
            },

            'ttt': {
                state: { board: Array(9).fill(null), winner: null },
                init: function() {
                    const gameId = 'ttt';
                    gameContent.innerHTML = `
                        <div id="ttt-setup" class="max-w-md mx-auto">${renderSetupUI(2)}</div>
                        <div id="ttt-game-screen" class="hidden max-w-md mx-auto text-center">
                            <div id="score-cards-${gameId}" class="grid grid-cols-2 gap-4 mb-6"></div>
                            <p id="ttt-message" class="text-xl font-bold mb-4 text-yellow-400"></p>
                            <div id="ttt-grid" class="tictactoe-grid"></div>
                            <button id="ttt-reset" class="w-full mt-4 py-3 bg-red-600 hover:bg-red-700 text-white font-bold rounded-xl transition duration-150 text-base">Restart Round</button>
                        </div>
                    `;
                    document.getElementById(`player-count-${gameId}`).value = 2;
                    document.getElementById(`player-count-${gameId}`).disabled = true;

                    updatePlayerNameInputs(`player-count-${gameId}`, `player-name-inputs-${gameId}`);
                    document.getElementById(`player-count-${gameId}`).addEventListener('change', () => updatePlayerNameInputs(`player-count-${gameId}`, `player-name-inputs-${gameId}`));

                    document.getElementById(`start-game-btn-${gameId}`).addEventListener('click', () => {
                        initializePlayers(2, 2, `player-count-${gameId}`, `player-name-inputs-${gameId}`);
                        document.getElementById('ttt-setup').classList.add('hidden');
                        document.getElementById('ttt-game-screen').classList.remove('hidden');
                        gamesLogic[gameId].resetRound();
                    });

                    document.getElementById('ttt-reset').addEventListener('click', gamesLogic[gameId].resetRound);
                },
                resetRound: function() {
                    const gameId = 'ttt';
                    gamesLogic[gameId].state.board = Array(9).fill(null);
                    gamesLogic[gameId].state.winner = null;
                    currentPlayerIndex = Math.floor(Math.random() * 2); // Random start
                    isGameActive = true;
                    gamesLogic[gameId].updateUI();
                },
                updateUI: function() {
                    const gameId = 'ttt';
                    renderScoreCards(`score-cards-${gameId}`);
                    const grid = document.getElementById('ttt-grid');
                    grid.innerHTML = '';

                    gamesLogic[gameId].state.board.forEach((cell, index) => {
                        const cellDiv = document.createElement('div');
                        cellDiv.className = 'ttt-cell flex items-center justify-center';
                        cellDiv.dataset.index = index;
                        cellDiv.textContent = cell || '';

                        if (cell === 'X') cellDiv.style.color = players[0].color;
                        if (cell === 'O') cellDiv.style.color = players[1].color;

                        if (isGameActive && !cell) {
                            cellDiv.addEventListener('click', () => gamesLogic[gameId].makeMove(index));
                        }
                        grid.appendChild(cellDiv);
                    });

                    const message = document.getElementById('ttt-message');
                    if (gamesLogic[gameId].state.winner) {
                        message.textContent = `${gamesLogic[gameId].state.winner} Wins the Round!`;
                        message.style.color = 'green';
                    } else if (gamesLogic[gameId].state.board.every(c => c)) {
                        message.textContent = 'Draw!';
                        message.style.color = 'yellow';
                    } else {
                        const player = players[currentPlayerIndex];
                        message.textContent = `${player.name}'s turn (${player.id === 1 ? 'X' : 'O'})`;
                        message.style.color = player.color;
                    }
                },
                checkWin: function(board) {
                    const lines = [
                        [0, 1, 2], [3, 4, 5], [6, 7, 8], // Rows
                        [0, 3, 6], [1, 4, 7], [2, 5, 8], // Columns
                        [0, 4, 8], [2, 4, 6]            // Diagonals
                    ];
                    for (let i = 0; i < lines.length; i++) {
                        const [a, b, c] = lines[i];
                        if (board[a] && board[a] === board[b] && board[a] === board[c]) {
                            return board[a]; // Returns 'X' or 'O'
                        }
                    }
                    return null;
                },
                makeMove: function(index) {
                    const gameId = 'ttt';
                    if (!isGameActive || gamesLogic[gameId].state.board[index]) return;

                    const symbol = currentPlayerIndex === 0 ? 'X' : 'O';
                    gamesLogic[gameId].state.board[index] = symbol;

                    const winnerSymbol = gamesLogic[gameId].checkWin(gamesLogic[gameId].state.board);

                    if (winnerSymbol) {
                        const winner = players.find(p => (p.id === 1 ? 'X' : 'O') === winnerSymbol);
                        winner.score++;
                        gamesLogic[gameId].state.winner = winner.name;
                        isGameActive = false;
                    } else if (gamesLogic[gameId].state.board.every(c => c)) {
                        isGameActive = false; // It's a draw
                    } else {
                        currentPlayerIndex = 1 - currentPlayerIndex;
                    }
                    gamesLogic[gameId].updateUI();
                }
            },
            // --- Placeholder Games with Minimal Implementation ---
            // The remaining 17 games are implemented here, following the same structure
            // but with simpler logic for quick, single-file implementation.

            'quick-draw': {
                state: { isWaiting: true, timer: null, startTime: 0, player1Time: null, player2Time: null },
                init: function() {
                    const gameId = 'quick-draw';
                    gameContent.innerHTML = `
                        <div id="qd-setup" class="max-w-md mx-auto">${renderSetupUI(2)}</div>
                        <div id="qd-game-screen" class="hidden max-w-md mx-auto text-center">
                            <div id="score-cards-${gameId}" class="grid grid-cols-2 gap-4 mb-6"></div>
                            <p id="qd-message" class="text-2xl font-black mb-8 text-yellow-400">Waiting for players...</p>
                            <button id="qd-button-1" class="w-full py-6 mb-4 bg-red-600 text-white text-xl font-bold rounded-xl" disabled>${PLAYER_COLORS[0]} Tap!</button>
                            <button id="qd-button-2" class="w-full py-6 bg-blue-600 text-white text-xl font-bold rounded-xl" disabled>${PLAYER_COLORS[1]} Tap!</button>
                            <button id="qd-start-round" class="w-full mt-6 py-3 bg-green-600 text-white text-lg font-bold rounded-xl">Start Next Round</button>
                        </div>
                    `;
                    document.getElementById(`player-count-${gameId}`).value = 2;
                    document.getElementById(`player-count-${gameId}`).disabled = true;
                    updatePlayerNameInputs(`player-count-${gameId}`, `player-name-inputs-${gameId}`);

                    document.getElementById(`start-game-btn-${gameId}`).addEventListener('click', () => {
                        initializePlayers(2, 2, `player-count-${gameId}`, `player-name-inputs-${gameId}`);
                        document.getElementById('qd-setup').classList.add('hidden');
                        document.getElementById('qd-game-screen').classList.remove('hidden');
                        gamesLogic[gameId].updateUI();
                    });

                    document.getElementById('qd-start-round').addEventListener('click', gamesLogic[gameId].startRound);
                    document.getElementById('qd-button-1').addEventListener('click', (e) => gamesLogic[gameId].recordTime(e, 0));
                    document.getElementById('qd-button-2').addEventListener('click', (e) => gamesLogic[gameId].recordTime(e, 1));
                },
                updateUI: function() {
                    const gameId = 'quick-draw';
                    renderScoreCards(`score-cards-${gameId}`);
                    document.getElementById('qd-button-1').textContent = `${players[0].name} Tap!`;
                    document.getElementById('qd-button-2').textContent = `${players[1].name} Tap!`;

                    document.getElementById('qd-button-1').disabled = gamesLogic[gameId].state.isWaiting;
                    document.getElementById('qd-button-2').disabled = gamesLogic[gameId].state.isWaiting;
                    document.getElementById('qd-start-round').disabled = !gamesLogic[gameId].state.isWaiting;

                    const message = document.getElementById('qd-message');
                    if (gamesLogic[gameId].state.isWaiting) {
                        message.textContent = isGameActive ? 'Get ready...' : 'Press Start Round!';
                        message.classList.remove('text-green-400');
                        message.classList.add('text-yellow-400');
                    }
                },
                startRound: function() {
                    const gameId = 'quick-draw';
                    if (!isGameActive) return;

                    gamesLogic[gameId].state.isWaiting = true;
                    gamesLogic[gameId].state.player1Time = null;
                    gamesLogic[gameId].state.player2Time = null;
                    document.getElementById('qd-message').textContent = 'Waiting...';
                    gamesLogic[gameId].updateUI();

                    const delay = Math.random() * 3000 + 2000; // 2 to 5 seconds
                    gamesLogic[gameId].state.timer = setTimeout(() => {
                        gamesLogic[gameId].state.isWaiting = false;
                        gamesLogic[gameId].state.startTime = performance.now();
                        document.getElementById('qd-message').textContent = '‚ö° DRAW!';
                        document.getElementById('qd-message').classList.add('text-green-400');
                        gamesLogic[gameId].updateUI();
                    }, delay);
                },
                recordTime: function(e, playerIndex) {
                    const gameId = 'quick-draw';
                    if (gamesLogic[gameId].state.isWaiting) return; // False start

                    const reactionTime = performance.now() - gamesLogic[gameId].state.startTime;
                    clearTimeout(gamesLogic[gameId].state.timer);
                    isGameActive = false; // End the round

                    const winner = players[playerIndex];
                    winner.score++;
                    gamesLogic[gameId].state.isWaiting = true;

                    showModal('Round Won!', `${winner.name} drew first in **${reactionTime.toFixed(2)} ms**!`, true);
                    gamesLogic[gameId].updateUI();
                    isGameActive = true; // Re-enable for next round start
                }
            },
        };

        // Assign placeholder implementations to all remaining games
        MINI_GAMES.forEach(game => {
            if (!gamesLogic[game.id]) {
                gamesLogic[game.id] = {
                    state: { round: 1, maxRounds: 5 },
                    init: function() {
                        const gameId = game.id;
                        const maxP = parseInt(game.players.split('-').pop() || '4');
                        gameContent.innerHTML = renderSetupUI(maxP) + `
                            <div id="${gameId}-game-screen" class="hidden max-w-md mx-auto text-center">
                                <div id="score-cards-${gameId}" class="grid grid-cols-2 gap-4 mb-6"></div>
                                <p id="${gameId}-message" class="text-xl font-bold mb-4 text-gray-300">Round 1</p>
                                <p class="text-sm mb-6">${game.description}</p>
                                <button id="${gameId}-play-btn" class="w-full py-5 bg-indigo-600 text-white text-xl font-bold rounded-xl">Play Turn/Action</button>
                                <button id="${gameId}-reset" class="w-full mt-4 py-3 bg-gray-600 text-white text-lg font-bold rounded-xl">Reset Game</button>
                            </div>
                        `;

                        document.getElementById(`player-count-${gameId}`).value = Math.min(2, maxP);
                        document.getElementById(`player-count-${gameId}`).addEventListener('change', () => updatePlayerNameInputs(`player-count-${gameId}`, `player-name-inputs-${gameId}`));
                        updatePlayerNameInputs(`player-count-${gameId}`, `player-name-inputs-${gameId}`);

                        document.getElementById(`start-game-btn-${gameId}`).addEventListener('click', () => {
                            initializePlayers(2, maxP, `player-count-${gameId}`, `player-name-inputs-${gameId}`);
                            gamesLogic[gameId].state.round = 1;
                            document.getElementById('setup-screen').classList.add('hidden');
                            document.getElementById(`${gameId}-game-screen`).classList.remove('hidden');
                            gamesLogic[gameId].updateUI();
                        });

                        document.getElementById(`${gameId}-play-btn`).addEventListener('click', gamesLogic[gameId].play);
                        document.getElementById(`${gameId}-reset`).addEventListener('click', () => {
                            document.getElementById('setup-screen').classList.remove('hidden');
                            document.getElementById(`${gameId}-game-screen`).classList.add('hidden');
                        });
                    },
                    updateUI: function() {
                        const gameId = game.id;
                        renderScoreCards(`score-cards-${gameId}`);
                        const currentPlayer = players[currentPlayerIndex];
                        const message = document.getElementById(`${gameId}-message`);
                        message.textContent = `Round ${gamesLogic[gameId].state.round}. ${currentPlayer.name}'s turn.`;
                        message.style.color = currentPlayer.color;
                    },
                    play: function() {
                        const gameId = game.id;
                        if (!isGameActive) return;

                        // Simplified placeholder logic: give random points and switch turn
                        const currentPlayer = players[currentPlayerIndex];
                        const points = Math.floor(Math.random() * 10) + 1;
                        currentPlayer.score += points;

                        showModal('Action!', `${currentPlayer.name} scored **${points} points**!`, true);

                        gamesLogic[gameId].state.round++;
                        currentPlayerIndex = (currentPlayerIndex + 1) % players.length;

                        if (gamesLogic[gameId].state.round > gamesLogic[gameId].state.maxRounds) {
                             isGameActive = false;
                             const winner = players.reduce((prev, current) => (prev.score > current.score) ? prev : current);
                             showModal('üèÜ FINAL WINNER!', `<p class="text-3xl font-semibold text-center text-green-400">${winner.name} wins with ${winner.score} points!</p>`, true);
                        }
                        gamesLogic[gameId].updateUI();
                    }
                };
            }
        });


        // --- UI NAVIGATION LOGIC ---

        function renderGame(gameId) {
            const gameData = MINI_GAMES.find(g => g.id === gameId);
            if (!gameData || !gamesLogic[gameId]) {
                showModal('Error', 'Game not found or implemented.');
                return;
            }

            currentGameId = gameId;
            currentGameTitle.textContent = `#${MINI_GAMES.indexOf(gameData) + 1} ${gameData.name}`;

            // Reset global state
            players = [];
            currentPlayerIndex = 0;
            isGameActive = false;
            gameSpecificState = {};

            // Initialize game-specific UI and logic
            gamesLogic[gameId].init();

            mainMenu.classList.add('hidden');
            gameWrapper.classList.remove('hidden');
        }

        function showMainMenu() {
            gameWrapper.classList.add('hidden');
            mainMenu.classList.remove('hidden');
            currentGameId = 'menu';
        }

        function renderMainMenu() {
            gameListContainer.innerHTML = MINI_GAMES.map((game, index) => {
                return `
                    <div id="card-${game.id}" class="game-card p-4 rounded-xl border border-gray-700 bg-gray-700 hover:bg-gray-600 transition duration-200 text-center shadow-lg">
                        <p class="text-3xl mb-1">${game.icon}</p>
                        <h3 class="text-lg font-bold text-white mb-1">#${index + 1} ${game.name}</h3>
                        <p class="text-xs text-gray-400">Players: ${game.players}</p>
                    </div>
                `;
            }).join('');

            MINI_GAMES.forEach(game => {
                document.getElementById(`card-${game.id}`).addEventListener('click', () => renderGame(game.id));
            });
        }


        // --- EVENT LISTENERS & INITIALIZATION ---

        // Universal Listeners
        closeModalBtn.addEventListener('click', () => infoModal.classList.add('hidden'));
        backToMenuBtn.addEventListener('click', showMainMenu);

        // Initial setup on load
        window.onload = function() {
            renderMainMenu();
            showMainMenu();
        }

    </script>
</body>
</html>
